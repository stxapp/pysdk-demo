
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Trading Bot Example - STX SDK User Manual</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#trading-bot" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="STX SDK User Manual" class="md-header__button md-logo" aria-label="STX SDK User Manual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            STX SDK User Manual
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Trading Bot Example
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://bitbucket.org/sportsx/stx_pysdk/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M22.2 32A16 16 0 0 0 6 47.8a26.35 26.35 0 0 0 .2 2.8l67.9 412.1a21.77 21.77 0 0 0 21.3 18.2h325.7a16 16 0 0 0 16-13.4L505 50.7a16 16 0 0 0-13.2-18.3 24.58 24.58 0 0 0-2.8-.2L22.2 32zm285.9 297.8h-104l-28.1-147h157.3l-25.2 147z"/></svg>
  </div>
  <div class="md-source__repository">
    sportsx/stx_pysdk
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="STX SDK User Manual" class="md-nav__button md-logo" aria-label="STX SDK User Manual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    STX SDK User Manual
  </label>
  
    <div class="md-nav__source">
      <a href="https://bitbucket.org/sportsx/stx_pysdk/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M22.2 32A16 16 0 0 0 6 47.8a26.35 26.35 0 0 0 .2 2.8l67.9 412.1a21.77 21.77 0 0 0 21.3 18.2h325.7a16 16 0 0 0 16-13.4L505 50.7a16 16 0 0 0-13.2-18.3 24.58 24.58 0 0 0-2.8-.2L22.2 32zm285.9 297.8h-104l-28.1-147h157.3l-25.2 147z"/></svg>
  </div>
  <div class="md-source__repository">
    sportsx/stx_pysdk
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../guide/" class="md-nav__link">
        Developer Guide
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Trading Bot Example
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Trading Bot Example
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="trading-bot">Trading Bot<a class="headerlink" href="#trading-bot" title="Permanent link">&para;</a></h1>
<p>This document will guide you on the usage of SportsX SDK with an example to create a Trading Bot.</p>
<p>Let's just set some requirements of the bot, what is the target of this bot what features this bot would have etc.</p>
<p>The objective of this bot is to perform the following routine:</p>
<div class="highlight"><pre><span></span><code> - Get all the available markets from the API.
 - Pick a random market.
 - Extract the probability of the selected market.
 - Generate a random probability cap between 0 and 10 to add into the market current probability.
   probability = current_probability + (current_probability * random.choice(range(11)) / 100)
 - Generate the price using the generated probability and market&#39;s current max price.
   price = max market price * probability
 - Pick random quantity between 1 and 10
   quantity = random.choice(range(11))
 - Place an order with market id, price and quantity.
 - Initiate market channel and check if price shifts 5% either up down for that market.
   - Cancel the created order.
   - Post new order with new price.
</code></pre></div>
<p>Before the implementation we are going to need the SDK.</p>
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h3>
<p>Install the latest release via pip:</p>
<div class="highlight"><pre><span></span><code>pip install stx-pysdk
</code></pre></div>
<p>The SDK is built for python 3 only.
If your system has both python2 and python3 manager installed then by default "pip" refers to python2 manager,
so in order to install for python3 "pip3" would be used</p>
<div class="highlight"><pre><span></span><code>pip3 install stx-pysdk
</code></pre></div>
<h3 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h3>
<p>We will start with the creating a project with name <code>trading_bot</code>.
And create a python file with name <code>bot.py</code> in which we are creating a class <code>TradingBot</code>.
This class will contain all the operations of the bot.
<div class="highlight"><span class="filename">trading_bot/bot.py</span><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div>
Now let's create a method called <code>initiate</code> that will be called to initiate the bot,
this method will be responsible for calling the required operations as defined in the requirements.</p>
<p>Before doing any operation it is required to have a valid authentication so the first step would be performing the authentication.
We'll add an auth method <code>__authenticate</code> that will be called here to perform the authentication.</p>
<p>After the auth the next step is to get the available markets, so we'll add a method <code>__populate_markets</code> that will be
responsible for storing the market data to the bot object.</p>
<p>Next step would be picking up the random market from previously stored markets data.</p>
<p>After selecting the market we'll perform some computation based on our requirements and algorithms.</p>
<p><code>__compute_price</code> to compute the price at which we'll be placing the order.</p>
<p><code>__get_quantity</code> to get the quantity of the shares to be purchased.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">initiate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
        <span class="c1"># Starts the bot by preforming the authentication for the APIs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__authenticate</span><span class="p">()</span>
        <span class="c1"># Populates the available markets using the market API.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__populate_markets</span><span class="p">()</span>
        <span class="c1"># Randomly pick a market to which the order will be placed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pick_random_market</span><span class="p">()</span>
        <span class="c1"># compute the price on which the order will be placed</span>
        <span class="n">price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_price</span><span class="p">()</span>
        <span class="c1"># get the quantity of the shares for the order</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_quantity</span><span class="p">()</span>
</code></pre></div>
<p>For the authentication of the bot we need username and password, lets just update the authentication method to accept
username and password as parameters to perform the authentication now the function would be.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">initiate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
        <span class="c1"># Starts the bot by preforming the authentication for the APIs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__authenticate</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="o">...</span>
</code></pre></div>
<p>Now its time to define these methods. We'll now use the provided StxClient by importing it from the installed SDK.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">stxsdk</span> <span class="kn">import</span> <span class="n">StxClient</span>

<span class="n">CLIENT</span> <span class="o">=</span> <span class="n">StxClient</span><span class="p">()</span>
</code></pre></div>
<p>Now that we have the client object, we'll be using it to interact with the SportsX APIs.</p>
<p>So the authentication method would be:
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__authenticate</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is authenticating the client with the provided credentials,</span>
<span class="sd">        and will raise the exception if authentication fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Executing bot user authentication.&quot;</span><span class="p">)</span>
        <span class="c1"># using StxClient object to initiate the login</span>
        <span class="n">login_response</span> <span class="o">=</span> <span class="n">CLIENT</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">})</span>
        <span class="c1"># if the provided credentials are not correct it would get success False flag in response</span>
        <span class="c1"># with relative error message</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">login_response</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to authenticate with the response: </span><span class="si">{</span><span class="n">login_response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AuthenticationFailedException</span><span class="p">(</span><span class="n">login_response</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
</code></pre></div>
This is only a sample code for the authentication API usage, you can perform your own operations in case of success and failures.</p>
<p>Market population method would be like:
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__populate_markets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is populating the bot markets by executing the marketInfos API</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initiating to populate the market data&quot;</span><span class="p">)</span>
        <span class="c1"># making selection object of the required response fields</span>
        <span class="c1"># You can have your own list of selections as per your requirements</span>
        <span class="c1"># To learn more about what Selection is you can check out the guide section.</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span>
            <span class="s2">&quot;title&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shortTitle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;marketId&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eventType&quot;</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">,</span>
            <span class="s2">&quot;maxPrice&quot;</span><span class="p">,</span>
            <span class="s2">&quot;probability&quot;</span><span class="p">,</span>
            <span class="s2">&quot;question&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eventStatus&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">,</span>
            <span class="s2">&quot;price&quot;</span><span class="p">,</span>
            <span class="n">bids</span><span class="o">=</span><span class="n">Selection</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">),</span>
            <span class="n">offers</span><span class="o">=</span><span class="n">Selection</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># executing the marketinfos API with the generated selection object</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Executing the marketinfos API.&quot;</span><span class="p">)</span>
        <span class="n">market_data</span> <span class="o">=</span> <span class="n">CLIENT</span><span class="o">.</span><span class="n">marketInfos</span><span class="p">(</span><span class="n">selections</span><span class="o">=</span><span class="n">selections</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">market_data</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
            <span class="c1"># if for any reason market info API fails, raise the exception</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to get markets with error: </span><span class="si">{</span><span class="n">market_data</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">MarketsNotFoundException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markets</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">market_data</span> <span class="o">=</span> <span class="n">market_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;marketInfos&quot;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">market_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> markets.&quot;</span><span class="p">)</span>
            <span class="c1"># storing the markets in the bot object to be randomly picked from</span>
            <span class="c1"># am making marketId to market data map for quick accessing the market</span>
            <span class="c1"># you can define your own data structure or store in database</span>
            <span class="c1"># depending on your use case, you can also filter out the markets based</span>
            <span class="c1"># on your preferences and requirements</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markets</span> <span class="o">=</span> <span class="p">{</span><span class="n">market</span><span class="p">[</span><span class="s2">&quot;marketId&quot;</span><span class="p">]:</span> <span class="n">market</span> <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">market_data</span><span class="p">}</span>
</code></pre></div>
This is sample code for populating the markets, you can define your own operation for markets extractions,
and different approaches for handling success and failure cases.
Here we are storing markets in the object, you can use any database to store them as per your requirements.</p>
<p>Next step is to define the market picking method:
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__pick_random_market</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is randomly picking a market from the available markets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Picking random market with the bids.&quot;</span><span class="p">)</span>
        <span class="c1"># infinitely looping to pick the random market with bids available</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># random.choice picks any element from the list in uniformly distributed manner</span>
            <span class="n">market</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markets</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="c1"># set the picked market to bot object for order creation</span>
            <span class="c1"># only if the market has bids available, and probability greater than 0</span>
            <span class="c1"># you can set any other conditions based on your requirements</span>
            <span class="k">if</span> <span class="n">market</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bids&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">market</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;probability&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">market</span> <span class="o">=</span> <span class="n">market</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The picked market is </span><span class="si">{</span><span class="n">market</span><span class="p">[</span><span class="s1">&#39;shortTitle&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, having id </span><span class="si">{</span><span class="n">market</span><span class="p">[</span><span class="s1">&#39;marketId&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="c1"># breaks the loop when the market is picked</span>
                <span class="k">break</span>
</code></pre></div>
This is sample code for picking up the market on which we'll be placing order, you can have your own algorithm
for picking the right market to place order on.</p>
<p>Once you picked the market now lets define the methods that will be calculating the parameters for placing the order.
Order required 5 parameters, <code>marktetId</code>, <code>orderType</code>, <code>action</code>, <code>quantity</code> and <code>price</code>.</p>
<p>We can get the <code>marketId</code> from the picked market object.</p>
<p>For this example we'll be using <code>LIMIT</code> as <code>orderType</code>, you can have your own logic for deciding the order type,
available order types are <code>LIMIT</code> and <code>MARKET</code></p>
<p>Setting <code>action</code> as <code>BUY</code> because this bot will be buying the shares, you can have your own logic to decide the action
based on you requirements.</p>
<p>For <code>quantity</code>, as per our requirement we will be randomly choosing the value between 1 and 10, you can have your own
logic to decide the quantity of the shares.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_quantity</span><span class="p">():</span>
        <span class="c1"># returns random quantity between 1 and 10</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
</code></pre></div>
<p>For <code>price</code> we have a defined formula that will be using to compute the price to place the order on.
You can have your own algorithm, logic to compute the price.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__extract_market_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is returning the probability of the selected market</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Getting the market probability.&quot;</span><span class="p">)</span>
        <span class="c1"># returns the market&#39;s probability</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">market</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__compute_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is computing the price using the market&#39;s current probability</span>
<span class="sd">        on which the order would be placed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># extract the current probability of the picked market</span>
        <span class="n">probability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_market_probability</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Computing the price for order creation, market current probability is </span><span class="si">{</span><span class="n">probability</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># get random probability cap between 0 and 10 to add into the market current probability</span>
        <span class="n">probability_cap</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
        <span class="c1"># increasing the probability by the percent of the computed cap</span>
        <span class="n">probability</span> <span class="o">+=</span> <span class="n">probability</span> <span class="o">*</span> <span class="n">probability_cap</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated probability is </span><span class="si">{</span><span class="n">probability</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># get the max price of all the bids</span>
        <span class="n">max_market_price</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bid</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">market</span><span class="p">[</span><span class="s2">&quot;bids&quot;</span><span class="p">])</span>
        <span class="c1"># price = integer type (max market price * computed probability)</span>
        <span class="c1"># type casting to int, because following command will return as float</span>
        <span class="c1"># and the price should be integer type</span>
        <span class="n">price</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_market_price</span> <span class="o">*</span> <span class="n">probability</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computed price is </span><span class="si">{</span><span class="n">price</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">price</span>
</code></pre></div>
<p>Once we get the values of all the required parameters we'll move to place the order.
Following is an example code for placing the order, you can have your own logic for placing the order and perform
different operations on success and failure cases.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__create_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market_id</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is posting a new order with the provided details</span>
<span class="sd">        :param market_id: unique ID of the market</span>
<span class="sd">        :param quantity: quantity of the shares to be purchased</span>
<span class="sd">        :param price: the price at which the shares would be purchased</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Initiating to create the order for market id: </span><span class="si">{</span><span class="n">market_id</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;with price: </span><span class="si">{</span><span class="n">price</span><span class="si">}</span><span class="s2"> and quantity: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="c1"># generate the request params for order creation</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;userOrder&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;marketId&quot;</span><span class="p">:</span> <span class="n">market_id</span><span class="p">,</span>
                <span class="s2">&quot;orderType&quot;</span><span class="p">:</span> <span class="s2">&quot;LIMIT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;BUY&quot;</span><span class="p">,</span>
                <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="n">quantity</span><span class="p">,</span>
                <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1"># request the confirmOrder API to post the order</span>
        <span class="n">order_response</span> <span class="o">=</span> <span class="n">CLIENT</span><span class="o">.</span><span class="n">confirmOrder</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="c1"># if the response is not successful raise the exception</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">order_response</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Order creating failed with error </span><span class="si">{</span><span class="n">order_response</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">OrderCreationFailure</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># if order created successfully then set the order data to the bot object</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">order_response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;confirmOrder&quot;</span><span class="p">][</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
        <span class="n">order_total</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">order</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Order is created with id: </span><span class="si">{</span><span class="n">order</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> and total price is </span><span class="si">{</span><span class="n">order_total</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
</code></pre></div>
<p>As you can see am storing the placed order information in the object, you can store it in the database or something as
per your requirements.</p>
<p>Now that we have placed the order, our next target is to keep checkout the market's price change and whenever price
shifts 5% up or down, cancel the order and place new one with different prices.</p>
<p>We have to define a method to cancel the order.
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__cancel_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is cancelling the order using cancelOrder API</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cancelling the order with id </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># generate the request params for cancelling the order</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;orderId&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]}</span>
        <span class="n">CLIENT</span><span class="o">.</span><span class="n">cancelOrder</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="c1"># resetting the bot current order to None after cancelling the order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
You can have your own logic of cancelling the order this is just an example usage on how you can cancel the order using SDK.</p>
<p>Now the question is how we can track the market prices or any other updates to the market. We have another client class
available in the SDK that allow us to connect with the SportsX channels (Websocket Channels).
You can learn more about what channels are, what channels are available in the guide section.</p>
<p>Here we will be using the market info channel, this channel asynchronously sends the updates to our passed consumers
which then can be used to perform any required operations.</p>
<p>In order to connect with the channel you have to create a StxChannelClient object by importing from the SDK.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">stxsdk</span> <span class="kn">import</span> <span class="n">StxChannelClient</span>
<span class="n">CHANNEL_CLIENT</span> <span class="o">=</span> <span class="n">StxChannelClient</span><span class="p">()</span>
</code></pre></div></p>
<p>Now this channel client will be used to connect with the SportsX market info channel.
We have to define a method that will be initiating the connection with channel and pass our defined consumers.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">initiate_market_info_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is initiating the market info channel to check for the price shifts</span>
<span class="sd">        here we are using asyncio for asynchronous communication with the server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">CHANNEL_CLIENT</span><span class="o">.</span><span class="n">market_info_join</span><span class="p">(</span>
                <span class="n">on_message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_market_info_update</span><span class="p">,</span>
                <span class="n">on_close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_market_close</span><span class="p">,</span>
                <span class="n">on_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_market_error</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>
<p>As you can see we are passing 3 methods, <code>on_market_info_update</code>, <code>on_market_close</code> and <code>on_market_error</code>.
These are the consumer methods, you can learn more about consumers on the guide section.
Quick introduction is that we can pass different consumer methods to each available events to be triggered on.</p>
<table>
<thead>
<tr>
<th align="left">Event</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>on_open</code></td>
<td align="left">It triggers when connected with the server</td>
</tr>
<tr>
<td align="left"><code>on_message</code></td>
<td align="left">It triggers when connection to the server is closed</td>
</tr>
<tr>
<td align="left"><code>on_close</code></td>
<td align="left">It triggers when connection to the server is closed</td>
</tr>
<tr>
<td align="left"><code>on_error</code></td>
<td align="left">It triggers when any error send by the server or exception occurs</td>
</tr>
<tr>
<td align="left"><code>default</code></td>
<td align="left">all of the above events are optional to be set, if you want a generic method to be run as default you can pass as it with default kwarg</td>
</tr>
</tbody>
</table>
<p>We are using asyncio to connect with channels, you can use any other asynchronous libraries to connect with the channels.</p>
<p>Following is the sample code of the consumer methods, you can have your own logic to be performed based on the requirements
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_market_info_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will be called whenever there is an update to a market.</span>
<span class="sd">        It checks if the update is happened to the market which we placed order for</span>
<span class="sd">        If market id matches, checkout for the price shift, if the shift is 5% up or down.</span>
<span class="sd">        Cancel the order and post new order with new price.</span>

<span class="sd">        Sample channel response:</span>
<span class="sd">        {</span>
<span class="sd">        &#39;closed&#39;: False,</span>
<span class="sd">        &#39;message_received&#39;: True,</span>
<span class="sd">        &#39;message&#39;: &#39;Message received&#39;,</span>
<span class="sd">        &#39;data&#39;: [</span>
<span class="sd">            None,</span>
<span class="sd">            None,</span>
<span class="sd">            &#39;market_info&#39;,</span>
<span class="sd">            &#39;market_updated&#39;,</span>
<span class="sd">            {</span>
<span class="sd">                &#39;d76112d8-2537-4c20-a376-37c74fbe7977&#39;: {</span>
<span class="sd">                    &#39;market_id&#39;: &#39;d76112d8-2537-4c20-a376-37c74fbe7977&#39;,</span>
<span class="sd">                    &#39;offers&#39;: [</span>
<span class="sd">                        {&#39;price&#39;: 5400, &#39;quantity&#39;: 10},</span>
<span class="sd">                        {&#39;price&#39;: 3500, &#39;quantity&#39;: 8},</span>
<span class="sd">                        {&#39;price&#39;: 3400, &#39;quantity&#39;: 66},</span>
<span class="sd">                    ],</span>
<span class="sd">                    &#39;price&#39;: 3150.0,</span>
<span class="sd">                    &#39;timestamp&#39;: &#39;2023-01-17T16:53:26.324012Z&#39;,</span>
<span class="sd">                    &#39;unix_timestamp&#39;: 1673974406324012,</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>
<span class="sd">        }</span>

<span class="sd">        the data key contains the server response</span>
<span class="sd">        data is a list, where 3rd element is the message event for example when market gets updated</span>
<span class="sd">        it will be &#39;market_updated&#39;, when new market created it will be &#39;market_created&#39;</span>
<span class="sd">        the 4th element is the market data, this market data will have mandatory</span>
<span class="sd">        &#39;market_id&#39; and &#39;timestamp&#39; fields indicating what market change and when with only the changed fields</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
            <span class="n">market_response_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">market_response_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="c1"># suppressing the StopIteration exception to pass the empty response data</span>
            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">StopIteration</span><span class="p">):</span>
                <span class="c1"># getting the market data from the response, response is a dictionary</span>
                <span class="c1"># using next with iter to get the first element of the response dict</span>
                <span class="c1"># next raises StopIteration exception if empty iter is provided</span>
                <span class="c1"># the above context is suppressing this case</span>
                <span class="n">market_data</span> <span class="o">=</span> <span class="n">market_response_data</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">market_response_data</span><span class="p">))]</span>
                <span class="c1"># checking if the server message is for market update</span>
                <span class="c1"># also if the update happened for the market we placed order on</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">market_response_type</span> <span class="o">==</span> <span class="s2">&quot;market_updated&quot;</span>
                    <span class="ow">and</span> <span class="n">market_data</span><span class="p">[</span><span class="s2">&quot;market_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">market</span><span class="p">[</span><span class="s2">&quot;marketId&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The market has been updated.&quot;</span><span class="p">)</span>
                    <span class="c1"># market data will only have those fields that are updated</span>
                    <span class="n">market_latest_price</span> <span class="o">=</span> <span class="n">market_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">)</span>
                    <span class="c1"># if the market data has price field, it means the market price is shifted</span>
                    <span class="k">if</span> <span class="n">market_latest_price</span><span class="p">:</span>
                        <span class="n">order_price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;The market price is changed, old price: </span><span class="si">{</span><span class="n">order_price</span><span class="si">}</span><span class="s2">, new price: </span><span class="si">{</span><span class="n">market_latest_price</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="c1"># get the 5% max and min price cap of the order&#39;s price</span>
                        <span class="n">max_shift</span> <span class="o">=</span> <span class="n">order_price</span> <span class="o">+</span> <span class="p">(</span><span class="n">order_price</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
                        <span class="n">min_shift</span> <span class="o">=</span> <span class="n">order_price</span> <span class="o">-</span> <span class="p">(</span><span class="n">order_price</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
                        <span class="c1"># checking if the latest price is between the price shift cap</span>
                        <span class="k">if</span> <span class="n">max_shift</span> <span class="o">&gt;</span> <span class="n">market_latest_price</span> <span class="o">&lt;</span> <span class="n">min_shift</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A price shift of 5</span><span class="si">% u</span><span class="s2">p/down is detected. Cancelling the order.&quot;</span><span class="p">)</span>
                            <span class="c1"># cancel the order and post the new order with new price for the same market</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__cancel_order</span><span class="p">()</span>
                            <span class="n">quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_quantity</span><span class="p">()</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Posting the new order with the latest market price.&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__create_order</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">market</span><span class="p">[</span><span class="s2">&quot;marketId&quot;</span><span class="p">],</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">market_latest_price</span>
                            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="c1"># if any general exception occurs, cancel the order if any posted</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The bot operation failed with exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__cancel_order</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_market_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Market channel has been closed with response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cancelling the order.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cancel_order</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_market_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Faced an exception or error with response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cancelling the order.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cancel_order</span><span class="p">()</span>
</code></pre></div></p>
<p>After including the order creation and market channel connection methods the bot <code>initiate</code> method could use them as following:
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingBot</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">initiate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is step by step performing the defined routines</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Starts the bot by preforming the authentication for the APIs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__authenticate</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="c1"># Populates the available markets using the market API.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__populate_markets</span><span class="p">()</span>
        <span class="c1"># Randomly pick a market to which the order will be placed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pick_random_market</span><span class="p">()</span>
        <span class="c1"># compute the price on which the order will be placed</span>
        <span class="n">price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_price</span><span class="p">()</span>
        <span class="c1"># get the quantity of the shares for the order</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_quantity</span><span class="p">()</span>
        <span class="c1"># Post the order with the generated quantity and price</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__create_order</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">market</span><span class="p">[</span><span class="s2">&quot;marketId&quot;</span><span class="p">],</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
            <span class="c1"># connecting with the market info channel to look out for the price shift</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initiate_market_info_channel</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="c1"># if any general exception occurs, cancel the order if any posted</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The bot operation failed with exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__cancel_order</span><span class="p">()</span>
</code></pre></div></p>
<p>you can check out the whole sample code of Trading Bot on the <a href="../../trading_bot">trading_bot package</a></p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../guide/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Developer Guide" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Developer Guide
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "toc.follow", "search.suggest", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>